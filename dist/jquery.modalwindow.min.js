/*! modalwindow 22-04-2014 */
!function(a,b,c,d){"use strict;";var e=c("html"),f=c(a),g=c(b),h=function(a){this._options=null,this._domElement=null,this._innerDomElement=null,this._lockDomElement=null,this._isOpen=!1,this._isActive=!0,this._contentIsLoaded=!1,this.getIdentifier=function(){return a}};h.prototype._initialize=function(){this._domElement=c('<div class="modalwindow-wrap" tabIndex="-1"><div class="modalwindow-skin"><div class="modalwindow-outer"><div class="modalwindow-inner"></div><div class="modalwindow-windowlock"></div></div></div></div>').appendTo(".modalwindow-overlay"),this._innerDomElement=this._domElement.find(".modalwindow-inner"),this._lockDomElement=this._domElement.find(".modalwindow-windowlock")},h.prototype._sizeWindow=function(){this._isOpen&&(this._domElement.height(this._options.height).width(this._options.width),this._innerDomElement.height(this._options.height).width(this._options.width))},h.prototype._repositionWindow=function(){this._isOpen&&this._domElement.css({top:Math.max(0,(f.height()-this._domElement.outerHeight())/2+f.scrollTop())+"px",left:Math.max(0,(f.width()-this._domElement.outerWidth())/2+f.scrollLeft())+"px"})},h.prototype.open=function(a){this._options=a,this._isOpen=!0,g.bind("show-window."+this.getIdentifier(),c.proxy(this._showWindowCallback,this)).trigger("show-overlay."+this._options.pluginNamespace),this._showWindow()},h.prototype.close=function(){this._isOpen&&this._isActive&&(g.trigger("unload-window."+this.getIdentifier()).unbind("close-window."+this.getIdentifier()).unbind("reposition-window."+this.getIdentifier()),this._domElement.hide().removeClass("modalwindow-opened"),this._innerDomElement.children().remove(),g.trigger({type:"window-closed."+this._options.pluginNamespace,windowIdentifier:this.getIdentifier()}),this._isOpen=!1)},h.prototype._showWindow=function(){g.unbind("show-window."+this.getIdentifier()).trigger({type:"window-opened."+this._options.pluginNamespace,windowIdentifier:this.getIdentifier()}).bind("reposition-window."+this._options.pluginNamespace,c.proxy(function(a){a.stopPropagation(),this._repositionWindow()},this)).bind("close-window."+this.getIdentifier(),c.proxy(this.close,close)),null==this._domElement&&this._initialize(),this._sizeWindow(),this._repositionWindow(),this._domElement.addClass("modalwindow-opened").show(),this._loadContent()},h.prototype.activate=function(){this._isActive||(this._isActive=!0,this._domElement.removeClass("modalwindow-deactivated"))},h.prototype.deactivate=function(){this._isActive&&(this._isActive=!1,this._lockDomElement.height(this._innerDomElement.outerHeight()).width(this._innerDomElement.outerWidth()),this._domElement.addClass("modalwindow-deactivated"))},h.prototype.isOpen=function(){return this._isOpen},h.prototype.isActive=function(){return this._isActive},h.prototype._loadContent=function(){if(!this._contentIsLoaded){var a=this;this.deactivate(),g.trigger("show-loading."+this._options.pluginNamespace),this._innerDomElement.children().remove(),c.ajax({url:this._options.typeOptions.href}).done(function(b){a._renderContentCallback(b)})}},h.prototype._renderContentCallback=function(a){this._innerDomElement.html(a),g.trigger("hide-loading."+this._options.pluginNamespace),this.activate()};var i=function(a){var b=this;this._options=a,this._collection={},this._orderedCollection=[],this._orderedCollection.remove=function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)},f.bind("resize."+this._options.pluginNamespace,function(){g.trigger("reposition-window."+b._options.pluginNamespace)}),g.bind("window-close."+this._options.pluginNamespace,function(a){a.stopPropagation(),null!=b.current()&&b.current.close()}).bind("window-opened."+this._options.pluginNamespace,function(a){a.stopPropagation(),b._windowOpenedCallback(a.windowIdentifier)}).bind("window-closed."+this._options.pluginNamespace,function(a){a.stopPropagation(),b._windowClosedCallback(a.windowIdentifier)})};i.prototype._windowOpenedCallback=function(a){null!=a&&this.has(a)&&(this.current()&&this.current()!==this.get(a)&&this.current().deactivate(),this._moveToTop(a))},i.prototype._windowClosedCallback=function(a){if(null!=a&&this.has(a)){var b,c,e=this.get(a)===this.current(),f=!1;for(b=this._orderedCollection.length-2;b>=0;b--)if(c=this._collection[this._orderedCollection[b]],c.isOpen()&&!c.isActive()){this._moveToTop(this._orderedCollection[b]),f=!0;break}f&&e&&this.current()!==d?this.current().activate():g.trigger("hide-overlay."+this._options.pluginNamespace)}},i.prototype._moveToTop=function(a){if(!this.has(a))throw"Invalid identifier given";var b=this._orderedCollection.indexOf(a);b>-1&&(this._orderedCollection.remove(b),this._orderedCollection.push(a))},i.prototype.current=function(){if(this.size()>0){var a=this._collection[this._orderedCollection[this._orderedCollection.length-1]];if(a.isOpen())return a}return d},i.prototype.size=function(){return this._orderedCollection.length},i.prototype.has=function(a){return this._collection[a]!==d},i.prototype.get=function(a){return this.has(a)?this._collection[a]:d},i.prototype.add=function(a,b){return this._collection[a]=b,this._orderedCollection.unshift(a),this.size()},i.prototype.remove=function(a){if(!this.has(a))return d;delete this._collection[a];var b=this._orderedCollection.indexOf(a);return b>-1&&this._orderedCollection.remove(b),this.size()};var j=function(a){this._domElement=null,this._options=a||{},g.bind("show-overlay."+this._options.pluginNamespace,c.proxy(this._showOverlayCallback,this)).bind("hide-overlay."+this._options.pluginNamespace,c.proxy(this.hide,this)).bind("show-loading."+this._options.pluginNamespace,c.proxy(this.showLoading,this)).bind("hide-loading."+this._options.pluginNamespace,c.proxy(this.hideLoading,this))};j.prototype._initialize=function(){this._domElement=c('<div class="modalwindow-overlay modalwindow-overlay-fixed" style="display:none;"></div>').appendTo(b.body)},j.prototype._showOverlayCallback=function(){this.show()},j.prototype.showLoading=function(){1!==c("> .modalwindow-loading").size()&&c('<div id="modalwindow-loading"><div></div></div>').appendTo("body")},j.prototype.hideLoading=function(){c("#modalwindow-loading").remove()},j.prototype.show=function(){this.isVisible()||(null==this._domElement&&this._initialize(),e.addClass("modalwindow-lock"),this._domElement.show())},j.prototype.hide=function(){this.isVisible()&&(e.removeClass("modalwindow-lock"),this._domElement.hide())},j.prototype.isVisible=function(){return null!=this._domElement&&this._domElement.is(":visible")},function(){c.modalwindow=function(a){var c=null;return c=null==a?b.current():b.get(a),c===d&&(c=new h(a),b.add(a,c)),c},c.modalwindow.options={pluginNamespace:"modalwindow",identifier:null,windowManager:{},overlay:{},modalWindow:{initializeWithClickEvent:!0,width:800,height:400,type:"ajax",typeOptions:{}}},c.fn.modalwindow=function(d){return d=c.extend(!0,{},c.modalwindow.options.modalWindow,{pluginNamespace:c.modalwindow.options.pluginNamespace},d),this.each(function(){var f=c(this),g=this.selector||"",h=c.extend(!0,{},d,f.data(d.pluginNamespace)||{});if(!c.data(this,h.pluginNamespace+"-instance")){var i=h.identifier;i?"__current"===i&&b.current()&&(i=b.current().getIdentifier()):i=h.pluginNamespace+"_"+e++,c.data(this,h.pluginNamespace+"-instance",c.modalwindow(i))}f.unbind("open."+h.pluginNamespace).unbind("click."+h.pluginNamespace).bind("open."+h.pluginNamespace,function(b){b.stopPropagation(),a(b,c(this),h)}),(g||h.initializeWithClickEvent)&&f.bind("click."+h.pluginNamespace,function(a){a.preventDefault(),c(a.target).trigger("open."+h.pluginNamespace)})})};var a=function(a,b,c){b.blur(),a.ctrlKey||a.altKey||a.shiftKey||a.metaKey||b.is(".modalwindow-window-wrap")||(c.typeOptions.href=b.attr("href"),b.data(c.pluginNamespace+"-instance").open(c))},b=new i(c.extend({},c.modalwindow.options.windowManager,{pluginNamespace:c.modalwindow.options.pluginNamespace})),e=(new j(c.extend({},c.modalwindow.options.overlay,{pluginNamespace:c.modalwindow.options.pluginNamespace})),0)}()}(window,document,jQuery);